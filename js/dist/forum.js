(()=>{var t={n:e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},d:(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{"use strict";t.r(e),t.d(e,{common:()=>k,extend:()=>l});const n=flarum.core.compat["forum/app"];var o=t.n(n);const r=flarum.core.compat["common/extenders"];var a=t.n(r);const u=flarum.core.compat["common/models/User"];var i=t.n(u),l=[new(a().Model)(i()).attribute("flamarktPhoneNumber")];function s(t,e){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},s(t,e)}const c=flarum.core.compat["common/app"];var f=t.n(c);const p=flarum.core.compat["common/Component"];var d=t.n(p);const h=flarum.core.compat["common/components/Select"];var b=t.n(h);const y=flarum.core.compat["common/utils/extractText"];var v=t.n(y),g=function(t){var e,n;function o(){for(var e,n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))||this).customMode=!1,e}n=t,(e=o).prototype=Object.create(n.prototype),e.prototype.constructor=e,s(e,n);var r=o.prototype;return r.oninit=function(e){t.prototype.oninit.call(this,e);var n=f().forum.attribute("flamarktPhoneNumberCountryCodes")||[],o=this.attrs.value||"";this.customMode=!!o&&!n.some((function(t){return 0===o.indexOf("+"+t[2])}))},r.view=function(){var t=this,e=f().forum.attribute("flamarktPhoneNumberCountryCodes")||[],n=this.attrs.value||"",o={},r=null,a=null;e.forEach((function(e,u){var m="+"+e[2];o[e[0]]=e[1]+" "+m,t.customMode||0!==n.indexOf(m)&&(n||0!==u)||(r=m,a=e[0])})),(f().forum.attribute("flamarktPhoneNumberUseAnyPrefix")||this.customMode)&&(o.custom=v()(f().translator.trans("flamarkt-phone-number.lib.field.custom")));var u=n.replace(r||"?","");return m(".FlamarktPhoneNumberInput",[e.length>0?b().component({className:"FlamarktPhoneNumberInput-select",options:o,value:a||"custom",onchange:function(o){if("custom"===o)return t.customMode=!0,void(n===r&&(null==t.attrs.onchange||t.attrs.onchange("")));t.customMode=!1;var a="+"+e.find((function(t){return t[0]===o}))[2];null==t.attrs.onchange||t.attrs.onchange(a+u.replace("+",""))},readonly:this.attrs.readonly,disabled:this.attrs.disabled}):null,m("input.FlamarktPhoneNumberInput-text.FormControl",{id:this.attrs.id,type:"text",value:u,onchange:function(n){var o=n.target.value;if(0===o.indexOf("+"))return t.customMode=!e.some((function(t){return 1===o.indexOf(t[2]+"")})),void(null==t.attrs.onchange||t.attrs.onchange(o));null==t.attrs.onchange||t.attrs.onchange((r||"")+o)},readonly:this.attrs.readonly,disabled:this.attrs.disabled,required:this.attrs.required})])},o}(d()),k={"components/PhoneNumberInput":g};const N=flarum.core.compat["common/extend"],P=((flarum.extensions["flamarkt-identity"]||{}).forum||{})["layouts/IdentityLayout"];var x=t.n(P);const O=flarum.core.compat["forum/components/SignUpModal"];var M=t.n(O);o().initializers.add("flamarkt-phone-number",(function(){x()&&((0,N.extend)(x().prototype,"oninit",(function(){var t=o().session.user;this.phoneNumber=t&&t.attribute("canEditFlamarktPhoneNumber")?t.attribute("flamarktPhoneNumber")||"":null})),(0,N.extend)(x().prototype,"fields",(function(t){var e=this;"string"==typeof this.phoneNumber&&t.add("flamarkt-phone-number",m(".Form-group",[m("label",{for:"flamarkt-identity-phone-number"},o().translator.trans("flamarkt-phone-number.lib.field.label")),g.component({id:"flamarkt-identity-phone-number",value:this.phoneNumber,onchange:function(t){e.phoneNumber=t,e.dirty=!0},disabled:this.saving})]))})),(0,N.extend)(x().prototype,"data",(function(t){"string"==typeof this.phoneNumber&&(t.flamarktPhoneNumber=this.phoneNumber)}))),(0,N.extend)(M().prototype,"oninit",(function(){this.flamarktPhoneNumber=o().forum.attribute("flamarktPhoneNumberOnSignup")?"":null})),(0,N.extend)(M().prototype,"fields",(function(t){var e=this;"string"==typeof this.flamarktPhoneNumber&&t.add("flamarkt-phone-number",m(".Form-group",[m("label",{for:"flamarkt-signup-phone-number"},o().translator.trans("flamarkt-phone-number.lib.field.label")),g.component({id:"flamarkt-signup-phone-number",value:this.flamarktPhoneNumber,onchange:function(t){e.flamarktPhoneNumber=t},disabled:this.loading,required:"required"===o().forum.attribute("flamarktPhoneNumberOnSignup"),user:o().session.user})]))})),(0,N.extend)(M().prototype,"submitData",(function(t){"string"==typeof this.flamarktPhoneNumber&&(t.flamarktPhoneNumber=this.flamarktPhoneNumber)}))}))})(),module.exports=e})();
//# sourceMappingURL=forum.js.map